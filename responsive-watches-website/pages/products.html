<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../assets/img/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <title>All Products - Rolex</title>
</head>
<body>
    <div id="header-placeholder"></div>

    <main class="main">
        <section class="section container" style="padding-top: 8rem;">
            <h1 class="section__title">All Products</h1>
            
            <div class="products__hero" style="text-align: center; margin-bottom: 3rem;">
                <p style="font-size: 1.2rem; color: var(--text-color); max-width: 600px; margin: 0 auto;">
                    Explore our complete collection of luxury timepieces, from classic designs to modern innovations. 
                    Find the perfect watch that matches your style and personality.
                </p>
            </div>

            <div class="products__search" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 0.75rem; align-items: end; margin: 2rem auto 2rem; max-width: 1000px;">
                <div>
                    <label for="searchQuery" style="display:block; margin-bottom: 0.25rem; color: var(--title-color); font-weight: 600;">Search</label>
                    <input id="searchQuery" type="text" placeholder="Search by name, brand, description" style="width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--first-color); border-radius: 0.5rem; background: var(--container-color); color: var(--text-color);">
                </div>
                <div>
                    <label for="minPrice" style="display:block; margin-bottom: 0.25rem; color: var(--title-color); font-weight: 600;">Min Price</label>
                    <input id="minPrice" type="number" min="0" placeholder="0" style="width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--first-color); border-radius: 0.5rem; background: var(--container-color); color: var(--text-color);">
                </div>
                <div>
                    <label for="maxPrice" style="display:block; margin-bottom: 0.25rem; color: var(--title-color); font-weight: 600;">Max Price</label>
                    <input id="maxPrice" type="number" min="0" placeholder="10000" style="width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--first-color); border-radius: 0.5rem; background: var(--container-color); color: var(--text-color);">
                </div>
                <div>
                    <label for="brandFilter" style="display:block; margin-bottom: 0.25rem; color: var(--title-color); font-weight: 600;">Brand</label>
                    <select id="brandFilter" style="width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--first-color); border-radius: 0.5rem; background: var(--container-color); color: var(--text-color);">
                        <option value="">All</option>
                    </select>
                </div>
                <div>
                    <button id="searchBtn" class="button" style="padding: 0.85rem 1.5rem; width: 100%;"><i class='bx bx-search'></i> Search</button>
                </div>
            </div>

            <div class="products__filters" style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 3rem; flex-wrap: wrap;">
                <button class="filter__btn active" data-filter="all" style="padding: 0.5rem 1.5rem; border: 2px solid var(--first-color); background: var(--first-color); color: white; border-radius: 2rem; cursor: pointer;">All</button>
                <button class="filter__btn" data-filter="luxury" style="padding: 0.5rem 1.5rem; border: 2px solid var(--first-color); background: transparent; color: var(--first-color); border-radius: 2rem; cursor: pointer;">Luxury</button>
                <button class="filter__btn" data-filter="sport" style="padding: 0.5rem 1.5rem; border: 2px solid var(--first-color); background: transparent; color: var(--first-color); border-radius: 2rem; cursor: pointer;">Sport</button>
                <button class="filter__btn" data-filter="classic" style="padding: 0.5rem 1.5rem; border: 2px solid var(--first-color); background: transparent; color: var(--first-color); border-radius: 2rem; cursor: pointer;">Classic</button>
            </div>

            <div class="products__container grid" id="products-container" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
                <!-- Products will be loaded from database -->
            </div>

            <div class="products__info" style="margin-top: 4rem; text-align: center;">
                <h2 style="margin-bottom: 2rem; color: var(--title-color);">Find Your Perfect Timepiece</h2>
                <p style="color: var(--text-color); max-width: 600px; margin: 0 auto 2rem;">
                    Each watch in our collection represents the pinnacle of horological excellence. 
                    From luxury dress watches to rugged sports models, we have something for every occasion.
                </p>
                <button class="button" onclick="showMoreProducts()">Load More Products</button>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>
    <div id="cart-placeholder"></div>

    <script src="../assets/js/api.js"></script>
    <script src="../assets/js/components.js"></script>
    <script>
        // Load, render and search/filter products
        let allProducts = [];
        const getBrand = (p) => {
            const name = (p.name || '').trim();
            return name ? name.split(' ')[0] : '';
        };
        const renderProducts = (list) => {
            const container = document.getElementById('products-container');
            if (!container) return;
            if (!list || list.length === 0) {
                container.innerHTML = `<div style="text-align:center; color: var(--text-color); padding: 2rem;">No products found.</div>`;
                return;
            }
            container.innerHTML = list.map(product => `
                <article class="products__card" style="background: var(--container-color); padding: 1.5rem; border-radius: 1rem; text-align: center; transition: transform 0.3s;">
                    <div style="margin-bottom: 1rem;">
                        <img src="../${product.image}" alt="${product.name}" style="width: 150px; height: 150px; object-fit: contain;" onerror="this.src='../assets/img/product1.png'">
                    </div>
                    <h3 style="margin-bottom: 0.5rem; color: var(--title-color);">${product.name}</h3>
                    <p style="color: var(--text-color); font-size: 0.9rem; margin-bottom: 1rem;">${product.description || ''}</p>
                    <span style="color: var(--first-color); font-weight: bold; font-size: 1.1rem; margin-bottom: 1rem; display: block;">${product.price}</span>
                    <button class="products__button" data-product-id="${product._id}" style="background: var(--first-color); color: white; border: none; padding: 0.75rem; border-radius: 50%; cursor: pointer; font-size: 1.25rem;">
                        <i class='bx bx-shopping-bag'></i>
                    </button>
                </article>
            `).join('');
            // Buttons
            document.querySelectorAll('.products__button').forEach(button => {
                button.addEventListener('click', async (e) => {
                    e.preventDefault();
                    const productId = button.getAttribute('data-product-id');
                    if (productId) {
                        await addToCart(productId, 1);
                    }
                });
            });
            // Hover
            document.querySelectorAll('.products__card').forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.style.transform = 'translateY(-5px)';
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'translateY(0)';
                });
            });
        };
        const populateBrandFilter = (products) => {
            const select = document.getElementById('brandFilter');
            if (!select) return;
            const brands = Array.from(new Set(products.map(getBrand).filter(Boolean))).sort();
            select.innerHTML = `<option value=\"\">All</option>` + brands.map(b => `<option value=\"${b}\">${b}</option>`).join('');
        };
        const applyFilters = () => {
            const q = (document.getElementById('searchQuery')?.value || '').trim().toLowerCase();
            const minP = parseFloat(document.getElementById('minPrice')?.value || '');
            const maxP = parseFloat(document.getElementById('maxPrice')?.value || '');
            const brand = (document.getElementById('brandFilter')?.value || '').toLowerCase();
            return allProducts.filter(p => {
                const matchesQuery = !q || (p.name && p.name.toLowerCase().includes(q)) || (p.description && p.description.toLowerCase().includes(q));
                const matchesBrand = !brand || getBrand(p).toLowerCase() === brand;
                const price = Number(p.price) || 0;
                const matchesMin = isNaN(minP) || price >= minP;
                const matchesMax = isNaN(maxP) || price <= maxP;
                return matchesQuery && matchesBrand && matchesMin && matchesMax;
            });
        };
        async function loadAllProducts() {
            try {
                allProducts = await getProducts();
                populateBrandFilter(allProducts);
                renderProducts(applyFilters());
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            loadAllProducts();
            const onFilterChange = () => renderProducts(applyFilters());
            const searchBtn = document.getElementById('searchBtn');
            if (searchBtn) searchBtn.addEventListener('click', (e) => { e.preventDefault(); onFilterChange(); });
            ['searchQuery', 'minPrice', 'maxPrice', 'brandFilter'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('input', onFilterChange);
                if (el && el.tagName === 'SELECT') el.addEventListener('change', onFilterChange);
            });
        });
        
        function showMoreProducts() {
            alert('More products coming soon!');
        }
    </script>
</body>
</html>